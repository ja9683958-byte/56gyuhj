<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Static Shortener (GitHub Pages)</title>
<style>
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; padding: 24px; max-width:900px; margin:0 auto; color:#222; }
  h1 { margin-top:0; }
  label { display:block; margin: 12px 0 6px; font-weight:600; }
  input[type="text"], input[type="url"], .btn { width:100%; box-sizing:border-box; padding:10px; border:1px solid #ccc; border-radius:6px; }
  input[type="file"] { margin-top:6px; }
  .row { display:flex; gap:12px; }
  .col { flex:1; }
  .btn { background:#1957ff; color:#fff; border:none; cursor:pointer; padding:10px; margin-top:12px; border-radius:6px; }
  .link-list { margin-top:18px; }
  .short-link { padding:8px 10px; border:1px solid #eee; margin-bottom:8px; border-radius:6px; background:#fafafa; display:flex; justify-content:space-between; align-items:center; gap:10px;}
  small { color:#666; }
  .preview { margin-top:18px; }
  .notice { margin-top:12px; font-size:13px; color:#555; }
</style>
</head>
<body>
  <h1>Static Link Shortener (for GitHub Pages)</h1>

  <div id="createForm">
    <label>Name (short label)</label>
    <input id="name" type="text" placeholder="Image / Link name (eg: HmXgJE)" />

    <label>Image (will display for 2s when link is opened)</label>
    <input id="imageFile" type="file" accept="image/*" />

    <label>Facebook URL (destination for mobile)</label>
    <input id="facebookUrl" type="url" placeholder="https://www.facebook.com/..." />

    <label>Other Link (destination for desktop/bots)</label>
    <input id="otherUrl" type="url" placeholder="https://example.com/..." />

    <button class="btn" id="createBtn">Create Shortlink</button>

    <div class="notice">
      After creating, copy the "Share link" and give it to others. The share link uses a hash (#r=CODE) so GitHub Pages can serve it without a backend.
    </div>
  </div>

  <div class="link-list" id="links"></div>

  <script>
  // --- storage key ---
  const STORE_KEY = 'static_shortener_links_v1';

  // load stored links
  function loadLinks() {
    try {
      const raw = localStorage.getItem(STORE_KEY);
      return raw ? JSON.parse(raw) : {};
    } catch(e) {
      console.error(e);
      return {};
    }
  }

  function saveLinks(obj) {
    localStorage.setItem(STORE_KEY, JSON.stringify(obj));
  }

  // generate short code (6 chars)
  function genCode() {
    const a = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let s = '';
    for (let i=0;i<6;i++) s += a[Math.floor(Math.random()*a.length)];
    return s;
  }

  // UI helpers
  const linksEl = document.getElementById('links');
  function renderLinks() {
    const links = loadLinks();
    linksEl.innerHTML = '';
    const base = location.origin + location.pathname;
    for (const code in links) {
      const item = links[code];
      const wrapper = document.createElement('div');
      wrapper.className = 'short-link';
      const left = document.createElement('div');
      left.innerHTML = <strong>${item.name || code}</strong><br><small>code: ${code}</small>;
      const right = document.createElement('div');
      const share = document.createElement('input');
      share.type = 'text';
      share.readOnly = true;
      share.value = base + '#r=' + code;
      share.style.width='360px';
      share.addEventListener('click', ()=>share.select());
      const del = document.createElement('button');
      del.textContent = 'Delete';
      del.style.marginLeft='8px';
      del.onclick = ()=>{
        if(!confirm('Delete this shortlink?')) return;
        delete links[code];
        saveLinks(links);
        renderLinks();
      };
      right.appendChild(share);
      right.appendChild(del);
      wrapper.appendChild(left);
      wrapper.appendChild(right);
      linksEl.appendChild(wrapper);
    }
    if (!Object.keys(links).length) {
      linksEl.innerHTML = '<small>No links yet — create one above.</small>';
    }
  }

  // file -> dataURL
  function readFileAsDataURL(file) {
    return new Promise((res,rej)=>{
      const r = new FileReader();
      r.onload = ()=>res(r.result);
      r.onerror = ()=>rej(new Error('file read error'));
      r.readAsDataURL(file);
    });
  }

  document.getElementById('createBtn').addEventListener('click', async ()=>{
    const name = document.getElementById('name').value.trim();
    const facebookUrl = document.getElementById('facebookUrl').value.trim();
    const otherUrl = document.getElementById('otherUrl').value.trim();
    const fileInput = document.getElementById('imageFile');
    if (!facebookUrl) return alert('Please provide the Facebook URL (mobile destination).');
    if (!otherUrl) return alert('Please provide the Other URL (desktop/bot destination).');

    let imgData = '';
    if (fileInput.files && fileInput.files[0]) {
      try {
        imgData = await readFileAsDataURL(fileInput.files[0]);
      } catch(e){
        console.error(e);
        return alert('Unable to read image file.');
      }
    }

    const links = loadLinks();
    let code;
    do { code = genCode(); } while (links[code]);

    links[code] = {
      name: name || code,
      image: imgData,         // may be '' if no image
      facebookUrl,
      otherUrl,
      createdAt: Date.now()
    };
    saveLinks(links);
    renderLinks();
    document.getElementById('name').value=''; document.getElementById('facebookUrl').value=''; document.getElementById('otherUrl').value=''; document.getElementById('imageFile').value='';
    alert('Shortlink created! Copy the link from the list below.');
  });

  // on load render existing
  renderLinks();

  // --- redirect logic when opening a shortlink (#r=CODE) ---
  (function handleHashRedirect(){
    // if no hash or not pattern, do nothing (show UI)
    const h = location.hash || '';
    if (!h.startsWith('#r=')) return;
    const code = h.slice(3);
    if (!code) return;
    const links = loadLinks();
    const entry = links[code];
    if (!entry) {
      document.body.innerHTML = '<p style="padding:24px">Shortlink not found in this browser. Note: this static system stores links in the browser that created them. If you created the link elsewhere you must import the data into this browser or use a server-based shortener.</p>';
      return;
    }

    // show image (if present) for 2 seconds, then redirect based on device.
    // We'll build a simple detection for mobile vs non-mobile.
    function isMobile() {
      const ua = navigator.userAgent || navigator.vendor || '';
      // basic mobile detection
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);
    }

    // build minimal preview UI
    document.body.innerHTML = '';
    const c = document.createElement('div');
    c.style.padding='18px';
    c.style.textAlign='center';
    c.innerHTML = <h2>${escapeHtml(entry.name)}</h2><p>Opening...</p>;
    if (entry.image) {
      const img = document.createElement('img');
      img.src = entry.image;
      img.style.maxWidth='90%';
      img.style.height='auto';
      img.style.borderRadius='8px';
      img.style.boxShadow='0 6px 18px rgba(0,0,0,0.12)';
      img.style.display='block';
      img.style.margin='12px auto';
      c.appendChild(img);
    } else {
      const note = document.createElement('div');
      note.style.marginTop='12px';
      note.innerHTML = '<small>No image — redirecting...</small>';
      c.appendChild(note);
    }
    const countdown = document.createElement('div');
    countdown.style.marginTop='10px';
    countdown.innerHTML = '<small id="cd">2</small> seconds';
    c.appendChild(countdown);
    document.body.appendChild(c);

    let seconds = 2;
    const cdEl = document.getElementById('cd');
    const interval = setInterval(()=>{
      seconds--;
      if (cdEl) cdEl.textContent = String(Math.max(0,seconds));
      if (seconds <= 0) {
        clearInterval(interval);
        // choose target
        const target = isMobile() ? entry.facebookUrl : entry.otherUrl;
        // fallback: if empty choose whichever exists
        const final = target || entry.facebookUrl || entry.otherUrl || '/';
        // do redirect
        window.location.replace(final);
      }
    }, 1000);

    // allow immediate jump if user clicks
    c.addEventListener('click', ()=> {
      clearInterval(interval);
      const target = isMobile() ? entry.facebookUrl : entry.otherUrl;
      window.location.replace(target || entry.facebookUrl || entry.otherUrl || '/');
    });

    // small escape helper
    function escapeHtml(s) {
      return (s||'').replace(/[&<>"']/g, m=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
  })();
  </script>
</body>
</html>